<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Keyboard Arena</title>
<!--    <script src="/js/FindId.js"></script>-->
    <link rel="stylesheet" type="text/css" href="/css/user/findId.css" th:href="@{/css/user/findId.css}">
</head>
<body>
<header>
    <h1>Keyboard Arena</h1>
</header>
<main>
    <div>
        <h2>아이디 찾기</h2>
        회원가입 시 입력하신 이메일로 아이디를 보내드립니다.<br>
        <form id="findIdForm" action="/user/find/id" method="POST">
            <label for="email">이메일 입력</label>
            <input type="email" id="email" name="email" required>
            <button type="submit">이메일 발송</button>
        </form><br>
        <div id="loading">
            아이디를 찾는 중입니다.<br>
            <img id="loading-img" alt="loading" src="/media/loading.gif">
        </div>
    </div>
</main>
<script>
    const findIdForm = document.getElementById("findIdForm");
    const loadingDiv = document.querySelector("#loading");

    findIdForm.addEventListener("submit", (e) => {
        e.preventDefault();
        sendEmail();
    })

    function sendEmail() {
        var formData = new FormData();
        formData.append("email", document.getElementById("email").value);

        loadingDiv.style.display = "block";

        fetch('/user/find/id', {
            method: 'POST',
            body: formData
        })
            .then(response => {
                if (response.ok) {
                    return response;
                } else {
                    throw new Error('아이디 찾기에 실패했습니다.');
                }
            })
            .then(data => {
                loadingDiv.style.display = "none";
                alert("이메일이 발송되었습니다.");
                // isSearching = false;
                // location.href='/login' 고민중
            })
            .catch(error => {
                loadingDiv.style.display = "none";
                console.log('Error: ', error);
                alert('확인할 수 없는 이메일입니다.')
            });
    }
</script>
</body>
</html>